#!/usr/bin/env ruby

require "yaml"

def generate_categories(category)
  output = "<ul>"
  category.each do |item|
    output << "<li>"
    output << "#{item["title"].capitalize}"
    output << " <ul>"
    item["items"].each do |item|
      output << "<li>#{item["item"]}</li>"
    end
    output << " </ul>"
    output << "</li>"
  end
  output << "</ul>"
  return output
end

puts "--- Generating stores files ---"

YAML.load_file("_data/stores.yml").each do |store|
  template_file = File.read("_templates/shop.md")
  page_url = "/shops/#{store["title"].downcase.gsub(" ", "_")}/"

  template_file.gsub!("{{ page_title }}", store["title"])
  template_file.gsub!("{{ page_url }}", page_url)
  template_file.gsub!("{{ title }}", store["title"])
  template_file.gsub!("{{ address }}", "#{store["address"]}, #{store["city"]}, #{store["country"]}")
  template_file.gsub!("{{ email }}", store["email"])
  template_file.gsub!("{{ url }}", store["url"])
  template_file.gsub!("{{ overview }}", store["overview"])
  template_file.gsub!("{{ details }}", generate_categories(store["categories"]))

  # Wrire the file to disc
  File.open("_pages/shops/#{store["title"].downcase.gsub(" ", "_")}.md", "w") {
    |file| file.write(template_file)
  }
end



